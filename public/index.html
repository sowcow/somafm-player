<!DOCTYPE html><html><head><meta charset="utf-8" /><title>soma-fm</title><script src="d3.js"></script><style>body {
  background-color: gray; }

html, body {
  height: 100%; }

body {
  margin: 0;
  overflow: hidden; }

svg {
  outline: solid red 1px; }
</style></head><body><svg><defs><pattern height="120" id="groovesalad" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/groovesalad120.png" y="0"></image></pattern><pattern height="120" id="spacestation" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/sss.jpg" y="0"></image></pattern><pattern height="120" id="7soul" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/7soul120.png" y="0"></image></pattern><pattern height="120" id="deepspaceone" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/deepspaceone120.gif" y="0"></image></pattern><pattern height="120" id="sonicuniverse" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/sonicuniverse120.jpg" y="0"></image></pattern><pattern height="120" id="thetrip" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/thetrip120.jpg" y="0"></image></pattern><pattern height="120" id="doomed" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/doomed120.png" y="0"></image></pattern><pattern height="120" id="u80s" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/u80s-120.png" y="0"></image></pattern><pattern height="120" id="sxfm" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/sxfm120.png" y="0"></image></pattern><pattern height="120" id="bagel" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/bagel120.png" y="0"></image></pattern><pattern height="120" id="airwaves" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/airwaves120.png" y="0"></image></pattern><pattern height="120" id="missioncontrol" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/missioncontrol120.jpg" y="0"></image></pattern><pattern height="120" id="bootliquor" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/bootliquor120.jpg" y="0"></image></pattern><pattern height="120" id="digitalis" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/digitalis120.png" y="0"></image></pattern><pattern height="120" id="dronezone" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/dronezone120.jpg" y="0"></image></pattern><pattern height="120" id="dubstep" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/dubstep120.png" y="0"></image></pattern><pattern height="120" id="poptron" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/poptron120.png" y="0"></image></pattern><pattern height="120" id="brfm" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/1023brc.jpg" y="0"></image></pattern><pattern height="120" id="lush" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/lush-x120.jpg" y="0"></image></pattern><pattern height="120" id="beatblender" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/blender120.png" y="0"></image></pattern><pattern height="120" id="earwaves" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/earwaves120.jpg" y="0"></image></pattern><pattern height="120" id="sf1033" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/sf1033120.png" y="0"></image></pattern><pattern height="120" id="secretagent" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/secretagent120.jpg" y="0"></image></pattern><pattern height="120" id="events" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/defcon120.png" y="0"></image></pattern><pattern height="120" id="indiepop" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/indychick.jpg" y="0"></image></pattern><pattern height="120" id="suburbsofgoa" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/sog120.jpg" y="0"></image></pattern><pattern height="120" id="cliqhop" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/cliqhop120.png" y="0"></image></pattern><pattern height="120" id="illstreet" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/illstreet.jpg" y="0"></image></pattern><pattern height="120" id="folkfwd" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/folkfwd120.jpg" y="0"></image></pattern><pattern height="120" id="covers" patternUnits="userSpaceOnUse" width="120" x="0" y="0"><image height="120" width="120" x="0" xlink:href="images/covers120.jpg" y="0"></image></pattern></defs></svg><script>(function() {
  window.OnResize = [];

  window.onresize = function() {
    var call, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = OnResize.length; _i < _len; _i++) {
      call = OnResize[_i];
      _results.push(call());
    }
    return _results;
  };

  window.P = function(x) {
    return console.log(x);
  };

  window.Pile = {
    shuffle: function (o){ for(var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x); return o; }
  };

}).call(this);

(function() {
  window.Player = (function() {
    function Player(named_urls) {
      var x, _i, _len;
      this.audio = new Audio;
      this.urls = {};
      for (_i = 0, _len = named_urls.length; _i < _len; _i++) {
        x = named_urls[_i];
        this.urls[x.name] = x.url;
      }
    }

    Player.prototype.play = function(name) {
      var url;
      url = this.urls[name];
      this.audio.src = url;
      return this.audio.play();
    };

    return Player;

  })();

}).call(this);

(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  window.SVG = (function() {
    function SVG(selector) {
      this.resizes_with_window = __bind(this.resizes_with_window, this);
      this.ignores_right_click = __bind(this.ignores_right_click, this);
      this.fills_the_whole_window = __bind(this.fills_the_whole_window, this);
      this.configure = __bind(this.configure, this);
      this.svg = d3.select(selector);
      this.configure();
    }

    SVG.prototype.configure = function() {
      this.fills_the_whole_window();
      this.ignores_right_click();
      return this.resizes_with_window();
    };

    SVG.prototype.fills_the_whole_window = function() {
      return this.svg.attr({
        width: window.innerWidth,
        height: window.innerHeight
      });
    };

    SVG.prototype.ignores_right_click = function() {
      return this.svg.on('contextmenu', function() {
        return d3.event.preventDefault();
      });
    };

    SVG.prototype.resizes_with_window = function() {
      return window.OnResize.push((function(_this) {
        return function() {
          return _this.fills_the_whole_window();
        };
      })(this));
    };

    return SVG;

  })();

}).call(this);

(function() {
  var charge, chosenCharge,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  charge = -270;

  chosenCharge = -1000;

  window.D3 = (function() {
    function D3(svg, data) {
      this.tick = __bind(this.tick, this);
      this.draw_nodes = __bind(this.draw_nodes, this);
      this.construct_force = __bind(this.construct_force, this);
      this.update_force = __bind(this.update_force, this);
      this.run = __bind(this.run, this);
      this.svg = svg.svg;
      this.data = Pile.shuffle(data);
    }

    D3.prototype.run = function() {
      var force_nodes, visual_nodes;
      force_nodes = this.construct_force(this.data);
      visual_nodes = this.draw_nodes(force_nodes);
      this.nodes = visual_nodes;
      this.force.on('tick', this.tick);
      window.OnResize.push((function(_this) {
        return function() {
          return _this.update_force();
        };
      })(this));
      this.nodes.call(this.force.drag);
      return this.nodes.on({
        contextmenu: (function(_this) {
          return function(d, i) {
            _this.chosenIndex = i;
            _this.update_force();
            return _this.chosen(d.name, i);
          };
        })(this)
      });
    };

    D3.prototype.update_force = function() {
      return this.force.size([this.width(), this.height()]).charge((function(_this) {
        return function(d, i) {
          if (!_this.chosenIndex) {
            return charge;
          }
          if (i === _this.chosenIndex) {
            return chosenCharge;
          } else {
            return charge / 2;
          }
        };
      })(this)).start();
    };

    D3.prototype.construct_force = function(data) {
      this.force = d3.layout.force().nodes(data).friction(0.999);
      this.update_force();
      return this.force.nodes();
    };

    D3.prototype.draw_nodes = function(force_nodes) {
      return this.svg.selectAll('.node').data(force_nodes).enter().append('circle').attr({
        fill: function(d) {
          return "url(#" + d.name + ")";
        }
      }).attr({
        r: 60
      });
    };

    D3.prototype.tick = function() {
      return this.nodes.attr('cx', function(d) {
        return d.x;
      }).attr('cy', function(d) {
        return d.y;
      }).attr('r', (function(_this) {
        return function(d, i) {
          if (!_this.chosenIndex) {
            return 60;
          }
          if (i === _this.chosenIndex) {
            return 60;
          } else {
            return 40;
          }
        };
      })(this));
    };

    return D3;

  })();

}).call(this);

(function() {
  var RadioApp,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  RadioApp = (function() {
    function RadioApp(url, svg_selector) {
      this.load_stations = __bind(this.load_stations, this);
      this.load_stations(url, (function(_this) {
        return function(stations) {
          var container, d3, player;
          player = new Player(stations);
          container = new SVG(svg_selector);
          d3 = new D3(container, stations);
          d3.chosen = function(name) {
            return player.play(name);
          };
          d3.width = function() {
            return window.innerWidth;
          };
          d3.height = function() {
            return window.innerHeight;
          };
          return d3.run();
        };
      })(this));
    }

    RadioApp.prototype.load_stations = function(url, call) {
      return d3.json(url, (function(_this) {
        return function(error, data) {
          return call(data);
        };
      })(this));
    };

    return RadioApp;

  })();

  new RadioApp('stations.json', 'svg');

}).call(this);
</script></body></html>